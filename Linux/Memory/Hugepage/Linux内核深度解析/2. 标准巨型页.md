

# 使用方法

编译内核时需要打开配置宏 `CONFIG_HUGETLBFS` 和`CONFIG_HUGETLB_PAGE`（打开配置宏 `CONFIG_HUGETLBFS` 的时候会自动打开）。



通过文件 “`/proc/sys/vm/nr_hugepages`” 指定**巨型页池**中**永久巨型页**的**数量**，预先分配指定数量的永久巨型页到巨型页池中。另一种方法是在**引导内核时**指定**内核参数** “`hugepages=N`” 以分配永久巨型页，这是分配巨型页最可靠的方法，因为**内存还没有碎片化**。

有些平台支持**多种巨型页长度**。如果要分配特定长度的巨型页，必须在内核参数 “`hugepages`” 前面添加选择**巨型页长度的参数** “`hugepagesz=<size>[kKmMgG]`”。可以使用内核参数 “`default_hugepagesz=<size>[kKmMgG]`” 选择**默认的巨型页长度**。文件 “`/proc/sys/vm/nr_hugepages`” 表示**默认长度的永久巨型页的数量**。

通过文件 “`/proc/sys/vm/nr_overcommit_hugepages`” 指定**巨型页池**中**临时巨型页的数量**，当**永久巨型页用完**的时候，可以从页分配器**申请临时巨型页**。

`nr_hugepages` 是**巨型页池**的**最小长度**，（`nr_hugepages + nr_overcommit_hugepages`）是巨型页池的**最大长度**。这两个参数的默认值都是0，至少要设置一个，不然分配巨型页会失败。


创建匿名的巨型页映射，其代码如下：

