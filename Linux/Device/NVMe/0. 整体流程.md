源代码阅读顺序

1. nvme_core 模块初始化

nvme_core_init():创建工作队列，类；申请设备号

2. nvme 模块初始化

nvme_init():注册 pci_driver 结构体

3. nvme 设备初始化

nvme_probe(): 加载 nvme 设备

* nvme_dev_map(): 申请IO内存并进行映射

* nvme_setup_prp_pools(): 创建DMA池

* nvme_init_ctrl(): 填充 nvme_ctrl 结构体，创建字符设备

* nvme_reset_ctrl(): 修改 nvme_ctrl 结构体状态，将 nvme_reset_work 加入工作队列 nvme_reset_wq

4. nvme 设备重启

nvme_reset_work(): 重启设备，涉及许多nvme协议相关知识，还有设备各阶段对寄存器的操作

* nvme_dev_disable(dev, false): 正常关机

* nvme_pci_enable(): 初始化pci设备（BAR寄存器，MSI-X 中断，CMB 等)

* nvme_pci_configure_admin_queue(): 映射 bar 寄存器，申请并初始化 admin 队列

* nvme_alloc_admin_tags(): 初始化 dev->admin_tagset 结构体，并创建请求队列

* nvme_init_identify(): 向 NVMe设备发送 identify 命令

* nvme_setup_io_queues(): 向 NVMe 设备发送 set feature 命令，再次申请中断号，注册中断函数 申请空间，创建IO队列

* nvme_dev_add(): 填充 dev->tagset 
    nvme_start_ctrl()->nvme_queue_scan()->ctrl->scan_work->nvme_scan_work()

1. 创建块设备

nvme_scan_work(): 发送一系列identify命令，创建块设备
    只需看nvme_scan_ns_list()->nvme_validate_ns()->nvme_alloc_ns()
    	nvme_alloc_ns():填充ns，创建块设备
```
