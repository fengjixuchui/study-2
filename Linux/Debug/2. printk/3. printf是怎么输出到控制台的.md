
在 Linux 下，printf 输出到控制台经历了 `app`->`libc`->`syscall`->`console` 驱动四个阶段。

# app

首先是用户态代码调用 printf 函数。printf 函数首先会检查其格式字符串中的特殊字符，如%d、%s 等，并根据这些特殊字符和传递给 printf 函数的参数来生成要输出的字符串。

```cpp
printf("hello, world!\n");
```

# libc

要能使用 printf 需要先包含：

```cpp
#include <stdio.h>
```

因为 printf 它是一个 libc 实现的标准库函数，定义如下：

```cpp
int printf(const char *format, ...);
```

想了解它怎么实现的, 最快速的办法不是看源码, 而是看 `man 3 printf`

![2023-07-04-10-43-03.png](./images/2023-07-04-10-43-03.png)

总结下来就是 2 个关键词，分别是 “格式字符串的格式化”、“打印到标准输出”.

标准输出? 通过 strace 查看

```
# strace printf "hello,world\n"
execve("/usr/bin/printf", ["printf", "hello,world\\n"], 0x7fff41e16358 /* 38 vars */) = 0
......
newfstatat(1, "", {st_mode=S_IFCHR|0620, st_rdev=makedev(0x88, 0x2), ...}, AT_EMPTY_PATH) = 0
write(1, "hello,world\n", 12hello,world
)           = 12
close(1)                                = 0
close(2)                                = 0
exit_group(0)                           = ?
+++ exited with 0 +++
```

标准输出就是 fd 1.

更详细的就是去看 glibc 源码.

```
$ git clone https://sourceware.org/git/glibc.git
$ vim glibc/stdio-common/printf.c
```