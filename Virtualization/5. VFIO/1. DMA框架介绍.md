
内核 DMA 框架用于将**内存物理地址 PA** 进行映射为**设备可访问**的 **IOVA**,并**为驱动提供 API 可用接口**.

它包括 **IOVA 框架**(包括IOVA的分配和释放), **IOMMU框架**(DMA MAP/UNMAP过程), **页表操作**, **ARM SMMU驱动**及**提供给驱动的API接口**.

![2022-08-14-00-20-29.png](./images/2022-08-14-00-20-29.png)

DMA API接口为驱动提供DMA分配/释放接口,包括**一致性 DMA**和**流式 DMA**;

IOMMU框架提供DMA MAP/UNMAP过程:根据DMA API接口提供的参数,分配/释放IOVA,并调用ARM驱动进行页表相关操作,建立/销毁页表项; 

IOVA框架提供IOVA的分配和释放,同时提供RCACHE缓存机制; 

ARM驱动负责与SMMU硬件的交互,包括SMMU识别,外设的识别等.


https://blog.csdn.net/flyingnosky/article/details/116767646