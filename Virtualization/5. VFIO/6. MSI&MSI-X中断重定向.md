
对于MSI或MSI-X中断，通过外设访问某个特定内存，从而触发对应的中断的产生。在没有SMMU时，外设直接访问该内存对应的物理地址即可。但在使能SMMU时，外设在访问某个物理内存前需要建立起IOVA到该物理地址的映射，然后发起对IOVA访问即可访问该物理地址，此过程称为MSI/MSI-X中断重定向。

![2022-08-14-00-48-04.png](./images/2022-08-14-00-48-04.png)

该过程在linux内核中是由函数iommu_dma_prepare_msi()实现。

```cpp
int iommu_dma_prepare_msi(struct msi_desc *desc, phys_addr_t msi_addr)
```

参数desc为该中断对应的描述符，参数msi_addr为产生该中断的物理地址；

![2022-08-14-00-49-37.png](./images/2022-08-14-00-49-37.png)

