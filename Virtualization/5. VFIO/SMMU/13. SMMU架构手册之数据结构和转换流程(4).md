
4 事务的属性：incoming，两阶段转换和overrides

除了地址，size和读写属性，传入的事务还可能带有其他属性，如访问类型（例如对于设备，WB-cached普通内存），共性性（如outer shareable），缓存分配提示，和权限相关的属性，指令/数据，特权和非特权，安全和非安全。部分属性用来检查访问决定转换表的页权限。在通过SMMU，面对系统的一个事务也可能有一组属性，这些属性可能被SMMU影响。

输入属性如何影响系统中的输出属性（与转换表属性和其他配置），这在章节13中描述。

在概念上系统提供输入属性，或者以设备特定的方式定义事务的属性，或在事务输入到SMMU之前由互联以系统特有的方式设置。

作为概述：

（1）权限相关的属性（指令/数据，特权/非特权）和读写属性用来检查转换表的权限，也可能拒绝访问。输入到SMMU的权限相关的属性可能在执行权限检查之前被per-device的基础上覆盖，这通过INSTCG，PRIVCFG和NSCFG STE域。SMMU输出这些属性。

NOTE： 若一个设备不能支持某种类型的traffic，覆盖可能非常有用。

（2）其他属性（内存类型，共享性，缓存hint）旨在对内存系统而不是对SMMU有效，比如，控制事务的缓存查找。输出到内存系统的属性是由用来转换输入地址的转换表描述符制定的属性的function。SMMU通过这个过程传输一个设备输入属性，因此设备可能影响最后的事务访问，且输入属性可能被设备的基础属性如MTCFG/MEMATTR，SHCFG，ALLOCCFG STE域覆盖。当stage1和stage2转换bypass时，被这些域修改的输入属性对输出的访问属性有用，但也可用与stage2的配置，设备sttream可能需要更精细的要求的访问行为，而不是虚拟的全局的stage2的转换表。

STE属性和权限覆盖域（MTCFG/MEMATTR，ALLOCCFG，INSTCFG，PRIVCFG和NSCFG）允许传入的值被使用，对每个域，可选择特定被覆盖的值。如INSTCFG可以配置stream为Always Data，而取代传入的INST属性。但在与设备紧密耦合或嵌入设备的SMMU实现中，传入的属性始终被认为是最合适的。当SMMU和设备保证传入的属性是正确的时，允许SMMU使用传入的值作为属性值。查看SMMU_IDR1.ATTR_TYPES_OVR和SMMU_IDR1.ATTR_PERMS_OVR。对于SMMU，它无法保证从client设备提供的属性一直正确，比如分离式SMMU设计，ARM强烈建议支持传入属性的覆盖。

5 转换表描述符

ARMv8-A VMSA定义stage2 block和页表描述符的 `bits[63:60]` 被SMMU保留使用。在SMMUV3.1和后面的版本，这些bits都被保留。

NOTE：当PBHA bit使能时，`bits[62:60]` 被PBHA机制影响。当PBHA不使能时，之前的定义被使用



https://blog.csdn.net/flyingnosky/article/details/122117310