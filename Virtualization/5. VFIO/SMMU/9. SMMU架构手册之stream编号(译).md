
每个即将到来的事务有地址,size和属性如READ/WRITE,安全/非安全,共享性,CACHE一致性.若超过一个client device连接到SMMU,这需要使用StreamID来区分不同的来源.StreamID是如何构建和传递的是由实现定义的.从逻辑上看,StreamID对应于启动事务的设备.

NOTE: 从物理设备到StreamID的映射必须由系统软件描述.

ARM建议StreamID为起始于0的密集命名空间.SteamID命令空间是基于SMMU.被赋予相同在StreamID的设备同时处在不同的SMMU后面的设备一般为不同的源.一个设备可能发出超过一个StreamID,不同的设备状态区分不同的数据流.

StreamID的大小是由实现定义的,从0~32bit.

StreamID用来在stream table中选择STE(Stream Table Entry),这包括每设备的配置.内存配置结构的最大内存配置结构存在2~streamsize entries.

另外一个属性SubstreamID,可选择性的在SMMU stage1阶段实现.SubstreamID的大小范围0~20bit,具体大小由实现定义,它用于区分来自同一个逻辑块的不同转换流,这些不同转换流与不同应用的地址转换相关.

NOTE:SubstreamID等同于PCIE ASID.这些概念也应用于非PCIE设备,它给出更普遍在名字.SubstreamID最大size为20bit,与PCIE ASID的最大size匹配.

即将来到的事务标示SubstreamID是否支持,这对不同的事务可能不一样.

这些属性和大小通过寄存器SMMU_IDR1决定.

StreamID用来区分事务配置的关键.StreamID被配置为bypass或经过转换,这些配置决定了当前在使用stage1还是stage2.Substreamid用来选择StreamID表示的stage1一组转换流中的某个,但对stage2没有影响,因为stage2仅受StreamID选择.

若仅支持stage2,不需要使用SubstreamID作输入.Stage1的实现不要求支持SubstreamID,因此不要求使用SubstreamID作输入.

SMMU可选择性的支持两种安全状态,SMMU的StreamID输入通过标志SEC_SID来决定输入StreamID是安全还是非安全的.非安全StreamID表示STE在非安全stream table而安全StreamID则表示STE在安全stream table中.在本文档,术语StreamID暗指SEC_SID特定指定的StreamID,并不是仅仅指StreamID对应的值.

ARM期望对于PCIE设备,StreamID由PCI RID来产生且 `StreamID[15:0]=RID[15:0]`.当一个SMMU管理多个RC时,ARM建议将16bit RID扩展为更大的StreamID(使用更高的bit),因此`StreamID[n:16]`表示哪个RC是转换请求在来源.在PCIE系统中,SubstreamID旨在以一对一方式直接从pasid获取.

因此为了让SMMU能够被PCIE client使用,支持的StreamID必须至少16bit.

https://blog.csdn.net/flyingnosky/article/details/122008382