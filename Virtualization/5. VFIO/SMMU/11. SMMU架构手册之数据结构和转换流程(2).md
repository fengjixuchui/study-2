
STE包含每个stream的配置：

1. 是否使能来之设备的流量；
2. 是否是stage1转换；
3. 是否是stage2转换
4. 哪个数据结构定位到stage1的转换表
若使用stage1，STE使用域STE.S1ContextPtr来指示内存中的一个或多个CD的地址。

CD关联起streamID和stage1转换表基指针（转换VA到IPA），基于stream的配置以及ASID。若使用SubStreamID，多个CD表示多个stage1的转换，每个SubstreamID指向一个。当stage1转换没有使能时SubStreamID指向的事务会被终止。

如果使用stage2，STE包含stage2转换表基指针（将IPA转换为PA）和VMID。如果多个设备都与某个特定的虚拟机相关，这意味着他们共享stage2转换表。多个STE可能都映射到同一个stage2转换表。

NOTE: ARM期望当hypervisor软件存在时，hypervisor管理stream表和stage2转换表。CD和stage1的转换表由guest OS来管理。另外，hypervisor可以充分使用stage1转换来实现自己的内部目的。当不使用hypervisor时，单个OS管理stream表和CD。要了解更多，可查章节3.6。

当事务带SubstreamID时，配置使能substreams，SubstreamID标识了选择stage1转换上下文的CD。在这个配置中，若substreamID没有使用时，行为依赖于STE.S1DSS标志：

1. 当STE.S1DISS=0b00，所有在事务需要携带SubstreamID，缺少SubstreamID意味着错误。当事务不带SubstreamID会被abort并event会被记录。
2. 当STE.S1DISS==0b01时，事务不带SubstreamID可被接受且被看作它的配置是stage1 bypass。仅当事务携带SubstreamID时才会使能stage1转换。
3. 当STE.S1DISS=0B10时，事务不带SubstreamID被接受且使用substream=0的CD。在这个配置下，带SubstreamID=0的事务被abort且event被记录。

CD和STE结构中的ASID和VMID用来tag TLB条目（这些条目是由CD和STE的配置来创建的）。这些tag用来查找和区分不同stream的地址空间的转换，或匹配接收到broadcast TLB操作的无效化项。实现可能使用这些tag来有效的允许不同的stream共享不同的转换表。



https://blog.csdn.net/flyingnosky/article/details/122074660