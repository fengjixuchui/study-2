
> DMA Remapping Hardware Unit Definition Structure, DMA 重映射硬件单元定义结构

一个 DRHD 结构唯一地表示平台中存在的重映射硬件单元。平台中的**每个 PCI 段**必须**至少有一个此结构**的实例。


<table style="width:100%">
<caption>DRHD结构</caption>
  <tr>
    <th>
    字段
    </th>
    <th>
    长度(字节)
    </th>
    <th>
    偏移位置(字节)
    </th>
    <th>
    描述
    </th>
  </tr>
  <tr>
    <td>
    Type
    </td>
    <td>
    2
    </td>
    <td>
    0
    </td>
    <td>
    0 - 表明是 DRHD 结构
    </td>
  </tr>
  <tr>
    <td>
    Length
    </td>
    <td>
    2
    </td>
    <td>
    2
    </td>
    <td>
    长度, 单位: 字节. 包括关联的重映射结构的描述表的长度
    </td>
  </tr>
  <tr>
    <td>
    Flags
    </td>
    <td>
    1
    </td>
    <td>
    4
    </td>
    <td>
    <b>Bit 0: INCLUDE_PCI_ALL</b><br>
    <li>如果清位, 此硬件单元在其作用域下仅包含指定分段中通过 “Device Scope” 字段显式标识的设备。设备可以是设备范围结构中“类型”字段所述的任何类型的设备，包括（但不限于）I/OxAPIC 和 HPET。</li>
    <li>
    <b>Bit 1: X2APIC_OPT_OUT</b> - 出于固件兼容性原因，<b>平台固件</b>可能会设置此字段以请求系统软件选择退出启用扩展 xAPIC（X2APIC）模式。仅当 INTR_REMAP 字段（位 0）置位时，此字段才有效。由于允许<b>固件</b>在 legacy xAPIC 模式下将平台移交给系统软件，因此在检测到平台中的 X2APIC 模式支持时，系统软件需要检查该字段为 “clear”。
    </li>
    </td>
  </tr>
  <tr>
    <td>
    Revision
    </td>
    <td>
    1
    </td>
    <td>
    8
    </td>
    <td>
    1
    </td>
  </tr>
  <tr>
    <td>
    Checksum
    </td>
    <td>
    1
    </td>
    <td>
    9
    </td>
    <td>
    整个表的总和必须为零。
    </td>
  </tr>
  <tr>
    <td>
    OEMID
    </td>
    <td>
    6
    </td>
    <td>
    10
    </td>
    <td>
    OEM ID
    </td>
  </tr>
  <tr>
    <td>
    OEM Table ID
    </td>
    <td>
    8
    </td>
    <td>
    16
    </td>
    <td>
    对于 DMAR 描述表，表 ID 是制造商型号 ID。
    </td>
  </tr>
  <tr>
    <td>
    OEM Revision
    </td>
    <td>
    4
    </td>
    <td>
    24
    </td>
    <td>
    OEM Revision
    </td>
  </tr>
  <tr>
    <td>
    Creator ID
    </td>
    <td>
    4
    </td>
    <td>
    28
    </td>
    <td>
    供应商 ID
    </td>
  </tr>
  <tr>
    <td>
    Creator Revision
    </td>
    <td>
    4
    </td>
    <td>
    32
    </td>
    <td>
    供应商 Revision
    </td>
  </tr>
  <tr>
    <td>
    Host Address Width
    </td>
    <td>
    1
    </td>
    <td>
    36
    </td>
    <td>
    此字段指示此<b>平台</b>支持的<b>最大 DMA 物理可寻址能力</b>。BIOS 报告的系统地址映射指示填充了此地址的哪些部分。<br><br>
    平台的主机地址宽度（Host Address With, HAW）计算为（N+1），其中 N 是此字段中报告的值。例如，对于支持 <b>40</b> 位物理可寻址性的平台，在此字段中报告值 100111b(47)。
    </td>
  </tr>
  <tr>
    <td>
    Reserved
    </td>
    <td>
    10
    </td>
    <td>
    38
    </td>
    <td>
    Reserved(0)
    </td>
  </tr>
  <tr>
    <td>
    Remapping Structures[]
    </td>
    <td>
    -
    </td>
    <td>
    48
    </td>
    <td>
    结构链表。该链表将包含一个或多个 <b>DMA 重映射硬件单元定义</b>（DMA Remapping Hardware Unit Definition, DRHD） 结构，以及零个或多个<b>预留内存区域报告</b>（Reserved Memory Region Reporting, RMRR）和 Root Port ATS 功能报告（Root Port ATS Capability Reporting, ATSR） 结构。下面会介绍这些结构。
    </td>
  </tr>
</table>

