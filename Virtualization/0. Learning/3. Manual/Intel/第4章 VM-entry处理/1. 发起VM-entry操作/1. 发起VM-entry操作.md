进入 VMX operation 模式后, 下面的代码展示了进入 VM 的一系列工作:

```assembly
    ;;
    ;; 初始化 VMCS buffer
    ;;
    mov esi, [VmcsA]
    call initialize_vmcs_buffer
    
                            
    ;;
    ;; 初始化 VMCS
    ;;
    vmclear [GuestA]
    jc @1
    jz @1         
    
    ;;
    ;; 加载 VMCS pointer
    ;;
    vmptrld [GuestA]
    jc @1
    jz @1  

    ;;
    ;; 更新当前 VMB 指针
    ;;
    mov R0, [VmcsA]
    mov [CurrentVmbPointer], R0

    ;;
    ;; 配置 VMCS
    ;;
    call setup_vmcs_region
    call update_system_status
    
    

    ;;
    ;; #BP 产生 VM-exit, #DB 保持执行
    ;;     
    SET_EXCEPTION_BITMAP            BP_VECTOR
    CLEAR_EXCEPTION_BITMAP          DB_VECTOR

    
    ;;
    ;; 进入 guest 环境
    ;;  
    call reset_guest_context
    or DWORD [gs: PCB.ProcessorStatus], CPU_STATUS_GUEST   
    vmlaunch
```