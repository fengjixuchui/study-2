
CR8 又被称为 `Task Priority-register`(**任务优先级寄存器**), 它在 64 位模式下才有效。它的结构如下所示。

![2021-04-15-21-43-41.png](./images/2021-04-15-21-43-41.png)

CR8的低4位(`bit 3:0`)提供了一个**Priority level值**, 这个值为`0～15`, 将控制处理器可以响应的中断级别, 这个中断属于maskable(可屏蔽的)硬件中断。

* 如果这个值被设为**0**, 则**可能响应所有的中断**;

* 如果设为**15**则处理器**不会响应所有的中断**。

# 中断优先级别

在x86/x64体系里中断向量为 `0～255`(**1 byte**, `2^8`), 因此使用了**16个中断优先级别**(`0～15`), 这个优先级别的计算如下。

```
Priority level=vector/16
```

软件不能使用`0～15`作为**硬件中断vector值**, 否则会产生错误, 它们是保留给系统使用的。所以实际优先级别**只使用了1～15**(对应于中断vector 16～255)。然而使用`16～31`向量号虽然不会产生错误, 但不推荐使用(它们也是保留给系统使用)。

CR8在**初始化**时为**0值**, **除了**向量号从**0**到**15**是**不可用**外, 可以响应所有的中断。如果设**CR8值为1**, 将抑制`16～31`的中断向量。

又如当设`CR8[3: 0]`为`1000B`时, `priority level`值为**8**, 处理器将对**优先级等于或低于8**的中断进行阻塞, 只响应优先级别大于8的中断。

CR8是local APIC的TPR(`task priority register`)对外的编程接口, 它们的值和作用是一样的。对CR8进行更改会影响到local APIC的TPR, 写入`CR8[3: 0]`的值会同时写入`TPR[7: 4]`中, `TPR[7: 4]`的值就等于`CR8[3: 0]`的值。

关于CR8与TPR的更多信息, 请参考18.9节的描述