
这两部分都在 Device Control Register（设备控制寄存器）里，如图5-66所示，分别由 `bit[14:12]` 和 `bit[7:5]` 控制。

设备控制寄存器:



# Maximum Payload Size(MPS）

控制一个 **TLP** 可以传输的**最大数据长度**。作为接收方，必须能处理跟 MPS 设定大小相同的 TLP 数据包，作为传输方，不允许创建超过 MPS 设定的 TLP 数据包。

PCIe 协议允许一个**最大**的 **Payload** 可以到**4KB**，但是规定了在**整个传输路径**上的**所有设备**，都必须使用**相同的 MPS 设置**，同时不能超过该路径上任何一个设备的MPS能力值。也就是说，`MPS Capability` 高的设备要迁就低的设备。以PCIe SSD来说，插到一块老掉牙的主板上（MPS只有128 Byte），你的Payload Size再大，也是没有用的。

系统的 **MPS 值**设置是在**上电以后**的**设备枚举配置阶段**完成的，以主板上的 PCIe RC 和 PCIe SSD 为例，它们都在 Device Capability Register 里声明自己能支持的各种 MPS, OS 的 PCIe 驱动侦测到他们各自的能力值，然后挑低的那个设置到两者的 Device Control Register 中。PCIe SSD 自身的 MPS capability 则是在其 PCIe core 初始化阶段设置的。

