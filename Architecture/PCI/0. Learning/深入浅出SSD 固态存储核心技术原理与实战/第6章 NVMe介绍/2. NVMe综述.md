
NVMe是一种主机（Host）与 SSD 之间通信的协议，它在协议栈中隶属高层，如图6-3所示。

NVMe处于协议栈的最高层:

![2023-02-04-23-47-06.png](./images/2023-02-04-23-47-06.png)

> NVMe 作为命令层和应用层协议，理论上可以适配在任何接口协议上。但 NVMe 协议的原配是 PCIe，因此如无特别说明，后面章节都是基于 `NVMe+PCIe`。

NVMe 在协议栈中处于应用层或者命令层，它是指挥官、军师，相当于三国时期诸葛亮的角色，“运筹帷幄之中，决胜千里之外”。军师设计好计谋，就交由手下五虎大将去执行。NVMe 的手下大将就是 PCIe，它所制定的任何命令，都交由 PCIe 去完成。虽然 NVMe 的命令也可以由别的接口完成，但 NVMe 与 PCIe 合作形成的战斗力无疑是最强的。

NVMe 是为 SSD 所生的。NVMe 出现之前，SSD 绝大多数用的是 AHCI 加 SATA 的组合，后者其实是为传统 HDD 服务的。与 HDD 相比，SSD 具有更低的延时和更高的性能，AHCI 已经不能跟上 SSD 性能发展的步伐，而是成为了制约 SSD 性能的瓶颈。所有 SATA 接口的 SSD，你去看性能参数，会发现都不会超过 600MB/s（或者说都不超过560MB/s）。如果碰到有人跟你说他的 SATA SSD 读取性能可以超过 600MB/s，直接拨打 12315 投诉。不是底层闪存带宽不够，是 SATA 接口速度限制了带宽，因为 SATA 3.0 最高带宽就是 600MB/s，而且不会再有 SATA 4.0 了，如图 6-4 所示。

SATA和PCIe接口速度对比:

![2023-02-04-23-50-17.png](./images/2023-02-04-23-50-17.png)

既然SATA接口速度太慢，那么用PCIe好了，不过上层协议还是AHCI。五虎上将有了，由刘备指挥，让人不禁感叹暴殄天物呀。刘备什么水平，诸葛亮出现之前，居无定所，一会跟着曹操混，一会又跟着吕布混，谁肯收留就跟谁混，惨呀！AHCI和刘备一个德行，只有一个命令队列，最多同时只能发32条命令，HDD时代（群雄逐鹿）还能混混，SSD时代（三足鼎立）就只有被灭的份。刘备需要三顾茅庐，请诸葛亮出山辅佐。同样，SSD需要PCIe，更需要NVMe。

在这样的背景下，Intel等巨头携天子以令诸侯，集大家的智慧，制定出了NVMe规范，目的就是释放SSD性能潜力，解SSD倒悬之苦。最初制定NVMe规范的主要公司如图6-5所示。

最初制定NVMe规范的主要公司:

![2023-02-04-23-51-10.png](./images/2023-02-04-23-51-10.png)

NVMe制定了主机与SSD之间通信的命令，以及命令如何执行的。NVMe有两种命令，一种叫Admin命令，用以主机管理和控制SSD；另外一种就是I/O命令，用以主机和SSD之间数据的传输，如图6-6所示。



![2023-02-04-23-52-12.png](./images/2023-02-04-23-52-12.png)



