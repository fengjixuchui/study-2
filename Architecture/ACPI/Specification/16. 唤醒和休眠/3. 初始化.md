
本节介绍 ACPI 平台的**初始化顺序**。从 `S2`、`S3` 或 `S4` **休眠状态**（由 ACPI 休眠状态定义）**唤醒**或在 **reset** 后，CPU 将从其 boot vector 开始执行。此时，初始化软件有很多选项，具体取决于硬件平台支持的内容。本节简要介绍应针对这些不同选项执行的操作。下图说明了启动软件的流程。

> The processor will start executing at its power-on reset vector when waking from an S2, S3, or S4 sleeping state, during a power-on sequence, or as a result of a hard or soft reset

当从 S2、S3 或 S4 休眠状态唤醒时，处理器将在其开机复位矢量(power-on reset vector)处开始执行，在上电串行顺序期间，或作为硬复位(hard reset)或软复位(soft reset)的结果。

当由于上电串行、硬复位或软复位或**从 S4 休眠状态唤醒**而从上电复位矢量执行时，**平台固件**执行完整的硬件初始化; 将系统置于引导配置中。然后，固件将控制权传递给**操作系统引导加载进程**(boot loader)。

当由于从 S2 或 S3 睡眠状态唤醒而从开机复位矢量执行时，平台固件**仅执行**将系统还原到平台在**初始操作系统启动之前**(initial operating system boot)所处的状态或**睡眠前配置状态**(pre-sleep configuration state)所需的**硬件初始化**。在多处理器系统中，**非引导处理器**应处于与**初始操作系统启动之前**(initial operating system boot)相同的状态。然后，平台固件通过跳转到 Firmware_Waking_Vector 或 
X_Firmware_Waking_Vector FACS 中的（有关详细信息，请参阅固件 ACPI 控制结构 （FACS））。在 S2 或 S3 睡眠状态期间，操作系统内存内容的内容**不得更改**。

首先，**平台运行时固件**通过检查在休眠会话之间保留的 SLP_TYP 寄存器值来确定这是从 S2 还是 S3 唤醒。如果这是 S2 或 S3 唤醒，则平台运行时固件会在跳转到 waking vector 之前还原系统的**最小上下文**。这包括：

CPU 配置。平台运行时固件还原每个 CPU 的睡眠前配置或初始启动配置（MSR、MTRR、固件更新、SMBase 等）。必须禁用中断（对于 IA-32 处理器，由 CLI 指令禁用）。


![2023-06-13-14-46-54.png](./images/2023-06-13-14-46-54.png)

